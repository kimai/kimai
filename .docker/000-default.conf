<VirtualHost *:8001>
    ServerAdmin webmaster@localhost
    DocumentRoot /opt/kimai/public

    PassEnv MAILER_FROM
    PassEnv APP_ENV
    PassEnv APP_SECRET
    PassEnv DATABASE_URL
    PassEnv MAILER_URL
    PassEnv TRUSTED_PROXIES

    SetEnvIf X-Forwarded-Proto https HTTPS=on
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-For "%{REMOTE_ADDR}s"
    RemoteIPHeader X-Forwarded-For

    # Define a macro to set the RemoteIPTrustedProxy directive
    <Macro SetTrustedProxy PROXY>
        RemoteIPTrustedProxy ${PROXY}
    </Macro>

    # Use the macro, passing the environment variable TRUSTED_PROXIES
    Use SetTrustedProxy %{TRUSTED_PROXIES}e

    <Directory "/opt/kimai/public">
        Require all granted
        DirectoryIndex index.php
        AllowOverride All
    </Directory>

</VirtualHost>

ServerName localhost
